{"version":3,"sources":["turbopack:///[project]/styles/AdminChat.module.css [app-ssr] (css module)","../../../../app/admin/chat/page.js"],"sourcesContent":["__turbopack_context__.v({\n  \"activeChat\": \"AdminChat-module__cyIL8W__activeChat\",\n  \"adminMessage\": \"AdminChat-module__cyIL8W__adminMessage\",\n  \"chatArea\": \"AdminChat-module__cyIL8W__chatArea\",\n  \"chatId\": \"AdminChat-module__cyIL8W__chatId\",\n  \"chatItem\": \"AdminChat-module__cyIL8W__chatItem\",\n  \"chatList\": \"AdminChat-module__cyIL8W__chatList\",\n  \"container\": \"AdminChat-module__cyIL8W__container\",\n  \"input\": \"AdminChat-module__cyIL8W__input\",\n  \"inputArea\": \"AdminChat-module__cyIL8W__inputArea\",\n  \"lastMessage\": \"AdminChat-module__cyIL8W__lastMessage\",\n  \"message\": \"AdminChat-module__cyIL8W__message\",\n  \"messages\": \"AdminChat-module__cyIL8W__messages\",\n  \"noChatSelected\": \"AdminChat-module__cyIL8W__noChatSelected\",\n  \"sendButton\": \"AdminChat-module__cyIL8W__sendButton\",\n  \"timestamp\": \"AdminChat-module__cyIL8W__timestamp\",\n  \"userMessage\": \"AdminChat-module__cyIL8W__userMessage\",\n});\n","'use client';\r\nimport { useState, useEffect, useRef } from 'react';\r\nimport styles from '../../../styles/AdminChat.module.css';\r\n\r\nexport default function AdminChat() {\r\n    const [chats, setChats] = useState([]);\r\n    const [selectedChatId, setSelectedChatId] = useState(null);\r\n    const [messages, setMessages] = useState([]);\r\n    const [input, setInput] = useState('');\r\n    const messagesEndRef = useRef(null);\r\n\r\n    // Poll for active chats\r\n    useEffect(() => {\r\n        fetchChats();\r\n        const interval = setInterval(fetchChats, 5000);\r\n        return () => clearInterval(interval);\r\n    }, []);\r\n\r\n    // Poll for messages in selected chat\r\n    useEffect(() => {\r\n        if (selectedChatId) {\r\n            fetchMessages(selectedChatId);\r\n            const interval = setInterval(() => fetchMessages(selectedChatId), 3000);\r\n            return () => clearInterval(interval);\r\n        }\r\n    }, [selectedChatId]);\r\n\r\n    const fetchChats = async () => {\r\n        try {\r\n            const res = await fetch('/api/chat');\r\n            if (res.ok) {\r\n                const data = await res.json();\r\n                setChats(data.chats || []);\r\n            }\r\n        } catch (error) {\r\n            console.error('Error fetching chats:', error);\r\n        }\r\n    };\r\n\r\n    const fetchMessages = async (id) => {\r\n        try {\r\n            const res = await fetch(`/api/chat?chatId=${id}`);\r\n            if (res.ok) {\r\n                const data = await res.json();\r\n                setMessages(data.messages || []);\r\n            }\r\n        } catch (error) {\r\n            console.error('Error fetching messages:', error);\r\n        }\r\n    };\r\n\r\n    const scrollToBottom = () => {\r\n        messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\r\n    };\r\n\r\n    useEffect(() => {\r\n        scrollToBottom();\r\n    }, [messages]);\r\n\r\n    const handleSend = async (e) => {\r\n        e.preventDefault();\r\n        if (!input.trim() || !selectedChatId) return;\r\n\r\n        const newMessage = {\r\n            text: input,\r\n            sender: 'admin',\r\n            timestamp: new Date().toISOString()\r\n        };\r\n\r\n        // Optimistic update\r\n        setMessages([...messages, newMessage]);\r\n        setInput('');\r\n\r\n        try {\r\n            await fetch('/api/chat', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ chatId: selectedChatId, message: newMessage })\r\n            });\r\n            fetchMessages(selectedChatId); // Sync\r\n        } catch (error) {\r\n            console.error('Error sending message:', error);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className={styles.container}>\r\n            <div className={styles.chatList}>\r\n                {chats.map(chat => (\r\n                    <div\r\n                        key={chat.id}\r\n                        className={`${styles.chatItem} ${selectedChatId === chat.id ? styles.activeChat : ''}`}\r\n                        onClick={() => setSelectedChatId(chat.id)}\r\n                    >\r\n                        <div className={styles.chatId}>User: {chat.id.substr(5)}</div>\r\n                        <div className={styles.lastMessage}>\r\n                            {chat.lastMessage?.text || 'No messages'}\r\n                        </div>\r\n                        <div className={styles.timestamp}>\r\n                            {chat.lastMessage?.timestamp ? new Date(chat.lastMessage.timestamp).toLocaleTimeString() : ''}\r\n                        </div>\r\n                    </div>\r\n                ))}\r\n                {chats.length === 0 && (\r\n                    <div style={{ padding: '1rem', color: '#888', textAlign: 'center' }}>\r\n                        No active chats\r\n                    </div>\r\n                )}\r\n            </div>\r\n            <div className={styles.chatArea}>\r\n                {selectedChatId ? (\r\n                    <>\r\n                        <div className={styles.messages}>\r\n                            {messages.map((msg, index) => (\r\n                                <div\r\n                                    key={index}\r\n                                    className={`${styles.message} ${msg.sender === 'admin' ? styles.adminMessage : styles.userMessage}`}\r\n                                >\r\n                                    {msg.text}\r\n                                </div>\r\n                            ))}\r\n                            <div ref={messagesEndRef} />\r\n                        </div>\r\n                        <form onSubmit={handleSend} className={styles.inputArea}>\r\n                            <input\r\n                                type=\"text\"\r\n                                value={input}\r\n                                onChange={(e) => setInput(e.target.value)}\r\n                                placeholder=\"Type a reply...\"\r\n                                className={styles.input}\r\n                            />\r\n                            <button type=\"submit\" disabled={!input.trim()} className={styles.sendButton}>\r\n                                Send\r\n                            </button>\r\n                        </form>\r\n                    </>\r\n                ) : (\r\n                    <div className={styles.noChatSelected}>\r\n                        Select a chat to view messages\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"0BAAA,EAAA,CAAA,CAAA,CACA,WAAA,uCACA,aAAA,yCACA,SAAA,qCACA,OAAA,mCACA,SAAA,qCACA,SAAA,qCACA,UAAA,sCACA,MAAA,kCACA,UAAA,sCACA,YAAA,wCACA,QAAA,oCACA,SAAA,qCACA,eAAA,2CACA,WAAA,uCACA,UAAA,sCACA,YAAA,uCACA,4CChBA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAEe,SAAS,IACpB,GAAM,CAAC,EAAO,EAAS,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,EAAE,EAC/B,CAAC,EAAgB,EAAkB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,MAC/C,CAAC,EAAU,EAAY,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,EAAE,EACrC,CAAC,EAAO,EAAS,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,IAC7B,EAAiB,CAAA,EAAA,EAAA,MAAA,AAAM,EAAC,MAG9B,CAAA,EAAA,EAAA,SAAA,AAAS,EAAC,KACN,IACA,IAAM,EAAW,YAAY,EAAY,KACzC,MAAO,IAAM,cAAc,EAC/B,EAAG,EAAE,EAGL,CAAA,EAAA,EAAA,SAAA,AAAS,EAAC,KACN,GAAI,EAAgB,CAChB,EAAc,GACd,IAAM,EAAW,YAAY,IAAM,EAAc,GAAiB,KAClE,MAAO,IAAM,cAAc,EAC/B,CACJ,EAAG,CAAC,EAAe,EAEnB,IAAM,EAAa,UACf,GAAI,CACA,IAAM,EAAM,MAAM,MAAM,aACxB,GAAI,EAAI,EAAE,CAAE,CACR,IAAM,EAAO,MAAM,EAAI,IAAI,GAC3B,EAAS,EAAK,KAAK,EAAI,EAAE,CAC7B,CACJ,CAAE,MAAO,EAAO,CACZ,QAAQ,KAAK,CAAC,wBAAyB,EAC3C,CACJ,EAEM,EAAgB,MAAO,IACzB,GAAI,CACA,IAAM,EAAM,MAAM,MAAM,CAAC,iBAAiB,EAAE,EAAA,CAAI,EAChD,GAAI,EAAI,EAAE,CAAE,CACR,IAAM,EAAO,MAAM,EAAI,IAAI,GAC3B,EAAY,EAAK,QAAQ,EAAI,EAAE,CACnC,CACJ,CAAE,MAAO,EAAO,CACZ,QAAQ,KAAK,CAAC,2BAA4B,EAC9C,CACJ,EAMA,CAAA,EAAA,EAAA,SAAA,AAAS,EAAC,KAHN,EAAe,OAAO,EAAE,eAAe,CAAE,SAAU,QAAS,EAKhE,EAAG,CAAC,EAAS,EAEb,IAAM,EAAa,MAAO,IAEtB,GADA,EAAE,cAAc,GACZ,CAAC,EAAM,IAAI,IAAM,CAAC,EAAgB,OAEtC,IAAM,EAAa,CACf,KAAM,EACN,OAAQ,QACR,UAAW,IAAI,OAAO,WAAW,EACrC,EAGA,EAAY,IAAI,EAAU,EAAW,EACrC,EAAS,IAET,GAAI,CACA,MAAM,MAAM,YAAa,CACrB,OAAQ,OACR,QAAS,CAAE,eAAgB,kBAAmB,EAC9C,KAAM,KAAK,SAAS,CAAC,CAAE,OAAQ,EAAgB,QAAS,CAAW,EACvE,GACA,EAAc,EAClB,CAAE,MAAO,EAAO,CACZ,KAF+B,GAEvB,IAF8B,CAEzB,CAAC,yBAA0B,EAC5C,CACJ,EAEA,MACI,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAW,EAAA,OAAM,CAAC,SAAS,WAC5B,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAW,EAAA,OAAM,CAAC,QAAQ,WAC1B,EAAM,GAAG,CAAC,GACP,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAEG,UAAW,CAAA,EAAG,EAAA,OAAM,CAAC,QAAQ,CAAC,CAAC,EAAE,IAAmB,EAAK,EAAE,CAAG,EAAA,OAAM,CAAC,UAAU,CAAG,GAAA,CAAI,CACtF,QAAS,IAAM,EAAkB,EAAK,EAAE,YAExC,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAW,EAAA,OAAM,CAAC,MAAM,WAAE,SAAO,EAAK,EAAE,CAAC,MAAM,CAAC,MACrD,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAW,EAAA,OAAM,CAAC,WAAW,UAC7B,EAAK,WAAW,EAAE,MAAQ,gBAE/B,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAW,EAAA,OAAM,CAAC,SAAS,UAC3B,EAAK,WAAW,EAAE,UAAY,IAAI,KAAK,EAAK,WAAW,CAAC,SAAS,EAAE,kBAAkB,GAAK,OAT1F,EAAK,EAAE,GAaF,IAAjB,EAAM,MAAM,EACT,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,MAAO,CAAE,QAAS,OAAQ,MAAO,OAAQ,UAAW,QAAS,WAAG,uBAK7E,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAW,EAAA,OAAM,CAAC,QAAQ,UAC1B,EACG,CAAA,EAAA,EAAA,IAAA,EAAA,EAAA,QAAA,CAAA,WACI,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAW,EAAA,OAAM,CAAC,QAAQ,WAC1B,EAAS,GAAG,CAAC,CAAC,EAAK,IAChB,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAEG,UAAW,CAAA,EAAG,EAAA,OAAM,CAAC,OAAO,CAAC,CAAC,EAAiB,AAAf,YAAI,MAAM,CAAe,EAAA,OAAM,CAAC,YAAY,CAAG,EAAA,OAAM,CAAC,WAAW,CAAA,CAAE,UAElG,EAAI,IAAI,EAHJ,IAMb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,IAAK,OAEd,CAAA,EAAA,EAAA,IAAA,EAAC,OAAA,CAAK,SAAU,EAAY,UAAW,EAAA,OAAM,CAAC,SAAS,WACnD,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CACG,KAAK,OACL,MAAO,EACP,SAAU,AAAC,GAAM,EAAS,EAAE,MAAM,CAAC,KAAK,EACxC,YAAY,kBACZ,UAAW,EAAA,OAAM,CAAC,KAAK,GAE3B,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CAAO,KAAK,SAAS,SAAU,CAAC,EAAM,IAAI,GAAI,UAAW,EAAA,OAAM,CAAC,UAAU,UAAE,eAMrF,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAW,EAAA,OAAM,CAAC,cAAc,UAAE,uCAO3D"}