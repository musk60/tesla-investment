{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER-PC/OneDrive/Documents/ANTIGRA/tesla-investment/app/api/chat/route.js"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport fs from 'fs';\r\nimport path from 'path';\r\n\r\nconst dataFilePath = path.join(process.cwd(), 'data', 'chats.json');\r\n\r\n// Helper to read chats\r\nfunction getChats() {\r\n    if (!fs.existsSync(dataFilePath)) {\r\n        return {};\r\n    }\r\n    const fileData = fs.readFileSync(dataFilePath, 'utf8');\r\n    try {\r\n        return JSON.parse(fileData);\r\n    } catch (error) {\r\n        return {};\r\n    }\r\n}\r\n\r\n// Helper to save chats\r\nfunction saveChats(chats) {\r\n    fs.writeFileSync(dataFilePath, JSON.stringify(chats, null, 2));\r\n}\r\n\r\nexport async function GET(request) {\r\n    const { searchParams } = new URL(request.url);\r\n    const chatId = searchParams.get('chatId');\r\n    const chats = getChats();\r\n\r\n    if (chatId) {\r\n        // Return specific chat messages\r\n        return NextResponse.json({ messages: chats[chatId] || [] });\r\n    } else {\r\n        // Return all chats (for admin)\r\n        // Sort by last message timestamp\r\n        const allChats = Object.entries(chats).map(([id, messages]) => ({\r\n            id,\r\n            messages,\r\n            lastMessage: messages[messages.length - 1]\r\n        })).sort((a, b) => {\r\n            const timeA = new Date(a.lastMessage?.timestamp || 0);\r\n            const timeB = new Date(b.lastMessage?.timestamp || 0);\r\n            return timeB - timeA;\r\n        });\r\n        return NextResponse.json({ chats: allChats });\r\n    }\r\n}\r\n\r\nexport async function POST(request) {\r\n    try {\r\n        const { chatId, message } = await request.json();\r\n        const chats = getChats();\r\n\r\n        if (!chats[chatId]) {\r\n            chats[chatId] = [];\r\n        }\r\n\r\n        chats[chatId].push(message);\r\n        saveChats(chats);\r\n\r\n        return NextResponse.json({ success: true, messages: chats[chatId] });\r\n    } catch (error) {\r\n        return NextResponse.json({ error: 'Failed to save message' }, { status: 500 });\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;AAEA,MAAM,eAAe,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,QAAQ;AAEtD,uBAAuB;AACvB,SAAS;IACL,IAAI,CAAC,wGAAE,CAAC,UAAU,CAAC,eAAe;QAC9B,OAAO,CAAC;IACZ;IACA,MAAM,WAAW,wGAAE,CAAC,YAAY,CAAC,cAAc;IAC/C,IAAI;QACA,OAAO,KAAK,KAAK,CAAC;IACtB,EAAE,OAAO,OAAO;QACZ,OAAO,CAAC;IACZ;AACJ;AAEA,uBAAuB;AACvB,SAAS,UAAU,KAAK;IACpB,wGAAE,CAAC,aAAa,CAAC,cAAc,KAAK,SAAS,CAAC,OAAO,MAAM;AAC/D;AAEO,eAAe,IAAI,OAAO;IAC7B,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;IAC5C,MAAM,SAAS,aAAa,GAAG,CAAC;IAChC,MAAM,QAAQ;IAEd,IAAI,QAAQ;QACR,gCAAgC;QAChC,OAAO,uKAAY,CAAC,IAAI,CAAC;YAAE,UAAU,KAAK,CAAC,OAAO,IAAI,EAAE;QAAC;IAC7D,OAAO;QACH,+BAA+B;QAC/B,iCAAiC;QACjC,MAAM,WAAW,OAAO,OAAO,CAAC,OAAO,GAAG,CAAC,CAAC,CAAC,IAAI,SAAS,GAAK,CAAC;gBAC5D;gBACA;gBACA,aAAa,QAAQ,CAAC,SAAS,MAAM,GAAG,EAAE;YAC9C,CAAC,GAAG,IAAI,CAAC,CAAC,GAAG;YACT,MAAM,QAAQ,IAAI,KAAK,EAAE,WAAW,EAAE,aAAa;YACnD,MAAM,QAAQ,IAAI,KAAK,EAAE,WAAW,EAAE,aAAa;YACnD,OAAO,QAAQ;QACnB;QACA,OAAO,uKAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAS;IAC/C;AACJ;AAEO,eAAe,KAAK,OAAO;IAC9B,IAAI;QACA,MAAM,EAAE,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,QAAQ,IAAI;QAC9C,MAAM,QAAQ;QAEd,IAAI,CAAC,KAAK,CAAC,OAAO,EAAE;YAChB,KAAK,CAAC,OAAO,GAAG,EAAE;QACtB;QAEA,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC;QACnB,UAAU;QAEV,OAAO,uKAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM,UAAU,KAAK,CAAC,OAAO;QAAC;IACtE,EAAE,OAAO,OAAO;QACZ,OAAO,uKAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAyB,GAAG;YAAE,QAAQ;QAAI;IAChF;AACJ"}}]
}